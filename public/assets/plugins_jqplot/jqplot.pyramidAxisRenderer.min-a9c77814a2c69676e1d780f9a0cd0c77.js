/**
 * jqPlot
 * Pure JavaScript plotting plugin using jQuery
 *
 * Version: 1.0.0b2_r1012
 *
 * Copyright (c) 2009-2011 Chris Leonello
 * jqPlot is currently available for use in all personal or commercial projects 
 * under both the MIT (http://www.opensource.org/licenses/mit-license.php) and GPL 
 * version 2.0 (http://www.gnu.org/licenses/gpl-2.0.html) licenses. This means that you can 
 * choose the license that best suits your project and use it accordingly. 
 *
 * Although not required, the author would appreciate an email letting him 
 * know of any substantial use of jqPlot.  You can reach the author at: 
 * chris at jqplot dot com or see http://www.jqplot.com/info.php .
 *
 * If you are feeling kind and generous, consider supporting the project by
 * making a donation at: http://www.jqplot.com/donate.php .
 *
 * sprintf functions contained in jqplot.sprintf.js by Ash Searle:
 *
 *     version 2007.04.27
 *     author Ash Searle
 *     http://hexmen.com/blog/2007/03/printf-sprintf/
 *     http://hexmen.com/js/sprintf.js
 *     The author (Ash Searle) has placed this code in the public domain:
 *     "This code is unrestricted: you are free to use it however you like."
 *
 * included jsDate library by Chris Leonello:
 *
 * Copyright (c) 2010-2011 Chris Leonello
 *
 * jsDate is currently available for use in all personal or commercial projects 
 * under both the MIT and GPL version 2.0 licenses. This means that you can 
 * choose the license that best suits your project and use it accordingly.
 *
 * jsDate borrows many concepts and ideas from the Date Instance 
 * Methods by Ken Snyder along with some parts of Ken's actual code.
 * 
 * Ken's origianl Date Instance Methods and copyright notice:
 * 
 * Ken Snyder (ken d snyder at gmail dot com)
 * 2008-09-10
 * version 2.0.2 (http://kendsnyder.com/sandbox/date/)     
 * Creative Commons Attribution License 3.0 (http://creativecommons.org/licenses/by/3.0/)
 *
 * jqplotToImage function based on Larry Siden's export-jqplot-to-png.js.
 * Larry has generously given permission to adapt his code for inclusion
 * into jqPlot.
 *
 * Larry's original code can be found here:
 *
 * https://github.com/lsiden/export-jqplot-to-png
 * 
 * 
 */
(function(a){a.jqplot.PyramidAxisRenderer=function(){a.jqplot.LinearAxisRenderer.call(this)},a.jqplot.PyramidAxisRenderer.prototype=new a.jqplot.LinearAxisRenderer,a.jqplot.PyramidAxisRenderer.prototype.constructor=a.jqplot.PyramidAxisRenderer,a.jqplot.PyramidAxisRenderer.prototype.init=function(b){this.position=null,this.drawBaseline=!0,this.baselineWidth=null,this.baselineColor=null,this.tickSpacingFactor=25,this._type="pyramid",this._splitAxis=!1,this._splitLength=null,this.category=!1,this._autoFormatString="",this._overrideFormatString=!1,a.extend(!0,this,b),this.renderer.options=b,this.resetDataBounds=this.renderer.resetDataBounds,this.resetDataBounds()},a.jqplot.PyramidAxisRenderer.prototype.resetDataBounds=function(){var a=this._dataBounds;a.min=null,a.max=null;var b;for(var c=0;c<this._series.length;c++){var d=this._series[c],e=d._plotData;for(var f=0,g=e.length;f<g;f++)if(this.name.charAt(0)==="x"){b=e[f][1];if(b!==null&&b<a.min||a.min===null)a.min=b;if(b!==null&&b>a.max||a.max===null)a.max=b}else{b=e[f][0];if(b!==null&&b<a.min||a.min===null)a.min=b;if(b!==null&&b>a.max||a.max===null)a.max=b}}},a.jqplot.PyramidAxisRenderer.prototype.draw=function(b,c){if(this.show){this.renderer.createTicks.call(this,c);var d=0,e;this._elem&&(this._elem.emptyForce(),this._elem=null),this._elem=a(document.createElement("div")),this._elem.addClass("jqplot-axis jqplot-"+this.name),this._elem.css("position","absolute"),this.name=="xaxis"||this.name=="x2axis"?this._elem.width(this._plotDimensions.width):this._elem.height(this._plotDimensions.height),this.labelOptions.axis=this.name,this._label=new this.labelRenderer(this.labelOptions);if(this._label.show){var f=this._label.draw(b,c);f.appendTo(this._elem),f=null}var g=this._ticks,h;for(var i=0;i<g.length;i++)h=g[i],h.show&&h.showLabel&&!h.isMinorTick&&this._elem.append(h.draw(b,c));h=null,g=null}return this._elem};var b=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],c={};for(var d=0,e=b.length;d<e;d++)c[b[d]]=b[d];a.jqplot.PyramidAxisRenderer.prototype.createTicks=function(b){var d=this.ticks,e=this._dataBounds,f,g,h,i,j,k,l,m,n,o,p,q=this.min,r=this.max,s,t,u,v,w,x,y,z,A,B,C=null,D;if(d.length){for(n=0,o=d.length;n<o;n++)s=d[n],t=new this.tickRenderer(this.tickOptions),a.isArray(s)?(t.value=s[0],t.label=s[1],t.setTick(s[0],this.name),this._ticks.push(t)):a.isPlainObject(s)?(a.extend(!0,t,s),t.axis=this.name,this._ticks.push(t)):(typeof s=="string"?B=n+b.defaultAxisStart:B=s,t.value=B,t.label=s,t.axis=this.name,this._ticks.push(t));this.numberTicks=d.length,this.min=this._ticks[0].value,this.max=this._ticks[this.numberTicks-1].value,this.tickInterval=(this.max-this.min)/(this.numberTicks-1);if(this._options.tickInterval){var E=this._options.tickInterval;for(n=0;n<this.numberTicks;n++)n%E!==0&&(this._ticks[n].isMinorTick=!0)}else{f=this.name.charAt(0)==="x"?this._plotDimensions.width:this._plotDimensions.height,A=Math.round(2+f/this.tickSpacingFactor);if(this.numberTicks>A){D=this.numberTicks-1;for(n=2;n<D;n++)if(D%n===0&&D/n<A){C=n-1;break}if(C!==null){var F=1;for(n=1,o=this._ticks.length;n<o;n++)F<=C?(this._ticks[n].show=!1,F+=1):F=1}}}D=[];if(this.category){this._ticks[0].showGridline=!1,this._ticks[0].showMark=!1;for(n=this._ticks.length-1;n>0;n--)t=new this.tickRenderer(this.tickOptions),t.value=this._ticks[n-1].value+this.tickInterval/2,t.label="",t.showLabel=!1,t.axis=this.name,this._ticks[n].showGridline=!1,this._ticks[n].showMark=!1,this._ticks.splice(n,0,t);t=new this.tickRenderer(this.tickOptions),t.value=this._ticks[0].value-this.tickInterval/2,t.label="",t.showLabel=!1,t.axis=this.name,this._ticks.unshift(t),t=new this.tickRenderer(this.tickOptions),t.value=this._ticks[this._ticks.length-1].value+this.tickInterval/2,t.label="",t.showLabel=!1,t.axis=this.name,this._ticks.push(t),this.tickInterval=this.tickInterval/2,this.numberTicks=this._ticks.length,this.min=this._ticks[0].value,this.max=this._ticks[this._ticks.length-1].value}}else{if(this.name.charAt(0)==="x"){f=this._plotDimensions.width;var G=Math.max(e.max,Math.abs(e.min)),H=Math.min(e.min,-G);h=H,i=G,j=i-h;if(this.tickOptions==null||!this.tickOptions.formatString)this._overrideFormatString=!0;u=30,v=Math.max(f,u+1),w=(v-u)/300,x=a.jqplot.LinearTickGenerator(h,i,w),console.log(h,i,w,x),console.log(x[0].toString(),x[1].toString()),y=h+j*(this.padMin-1),z=i-j*(this.padMax-1);if(h<y||i>z)y=h-j*(this.padMin-1),z=i+j*(this.padMax-1),x=a.jqplot.LinearTickGenerator(y,z,w),console.log(y,z,w,x);this.min=x[0],this.max=x[1],this.numberTicks=x[2],this._autoFormatString=x[3],this.tickInterval=x[4]}else{f=this._plotDimensions.height,h=e.min,i=e.max,p=this._series[0],this._ticks=[],j=i-h,c[j]&&(j+=1,i+=1),this.max=i,this.min=h,A=Math.round(2+f/this.tickSpacingFactor);if(j+1<=A)this.numberTicks=j+1,this.tickInterval=1;else for(var n=A;n>1;n--)if(j/(n-1)===Math.round(j/(n-1))){this.numberTicks=n,this.tickInterval=j/(n-1);break}}this._overrideFormatString&&this._autoFormatString!=""&&(this.tickOptions=this.tickOptions||{},this.tickOptions.formatString=this._autoFormatString);var I;for(n=0;n<this.numberTicks;n++)this.tickOptions.axis=this.name,I=this.min+this.tickInterval*n,this.name.charAt(0)==="x"&&(I=Math.abs(I)),this.tickOptions.value=this.min+this.tickInterval*n,t=new this.tickRenderer(this.tickOptions),t.label=t.prefix+t.formatter(t.formatString,I),this._ticks.push(t),this.name.charAt(0)==="x"&&b.axes.yMidAxis.show&&this.tickOptions.value===0&&(this._splitAxis=!0,this._splitLength=b.axes.yMidAxis.getWidth(),t=new this.tickRenderer(this.tickOptions),this._ticks.push(t),t.value=this.max/2e3);t=null}},a.jqplot.PyramidAxisRenderer.prototype.set=function(){var b=0,c,d=0,f=0,g,h,i,j=this._label==null?!1:this._label.show;if(this.show){h=this._ticks,e=h.length;for(g=0;g<e;g++)i=h[g],!i._breakTick&&i.show&&i.showLabel&&!i.isMinorTick&&(this.name.charAt(0)==="x"?c=i._elem.outerHeight(!0):c=i._elem.outerWidth(!0),c>b&&(b=c));if(this.name==="yMidAxis")for(g=0;g<e;g++)i=h[g],i._elem&&(c=(b-i._elem.outerWidth(!0))/2,i._elem.css("left",c));i=null,h=null,j&&(d=this._label._elem.outerWidth(!0),f=this._label._elem.outerHeight(!0));if(this.name==="xaxis")b+=f,this._elem.css({height:b+"px",left:"0px",bottom:"0px"});else if(this.name==="x2axis")b+=f,this._elem.css({height:b+"px",left:"0px",top:"0px"});else if(this.name==="yaxis")b+=d,this._elem.css({width:b+"px",left:"0px",top:"0px"}),j&&this._label.constructor==a.jqplot.AxisLabelRenderer&&this._label._elem.css("width",d+"px");else if(this.name==="yMidAxis"){var c=b/2-d/2;this._elem.css({width:b+"px",top:"0px"}),j&&this._label.constructor==a.jqplot.AxisLabelRenderer&&this._label._elem.css({width:d,left:c,top:0})}else b+=d,this._elem.css({width:b+"px",right:"0px",top:"0px"}),j&&this._label.constructor==a.jqplot.AxisLabelRenderer&&this._label._elem.css("width",d+"px")}},a.jqplot.PyramidAxisRenderer.prototype.pack=function(b,c){b=b||{},c=c||this._offsets;var d=this._ticks,e=this.max,f=this.min,g=c.max,h=c.min,i=this._label==null?!1:this._label.show;for(var j in b)this._elem.css(j,b[j]);this._offsets=c;var k=g-h,l=e-f,m=this._splitLength;this._splitAxis?(k-=this._splitLength,this.p2u=function(a){return(a-h)*l/k+f},this.u2p=function(a){return a<=0?(a-f)*k/l+h:(a-f)*k/l+h+m},this.series_u2p=function(a){return a<=0?(a-f)*k/l:(a-f)*k/l+m},this.series_p2u=function(a){return a*l/k+f}):(this.p2u=function(a){return(a-h)*l/k+f},this.u2p=function(a){return(a-f)*k/l+h},this.name.charAt(0)==="x"?(this.series_u2p=function(a){return(a-f)*k/l},this.series_p2u=function(a){return a*l/k+f}):(this.series_u2p=function(a){return(a-e)*k/l},this.series_p2u=function(a){return a*l/k+e}));if(this.show)if(this.name.charAt(0)==="x"){for(var n=0;n<d.length;n++){var o=d[n];if(o.show&&o.showLabel){var p;if(o.constructor==a.jqplot.CanvasAxisTickRenderer&&o.angle){var q=this.name=="xaxis"?1:-1;switch(o.labelPosition){case"auto":q*o.angle<0?p=-o.getWidth()+o._textRenderer.height*Math.sin(-o._textRenderer.angle)/2:p=-o._textRenderer.height*Math.sin(o._textRenderer.angle)/2;break;case"end":p=-o.getWidth()+o._textRenderer.height*Math.sin(-o._textRenderer.angle)/2;break;case"start":p=-o._textRenderer.height*Math.sin(o._textRenderer.angle)/2;break;case"middle":p=-o.getWidth()/2+o._textRenderer.height*Math.sin(-o._textRenderer.angle)/2;break;default:p=-o.getWidth()/2+o._textRenderer.height*Math.sin(-o._textRenderer.angle)/2}}else p=-o.getWidth()/2;var r=this.u2p(o.value)+p+"px";o._elem.css("left",r),o.pack()}}if(i){var s=this._label._elem.outerWidth(!0);this._label._elem.css("left",h+k/2-s/2+"px"),this.name=="xaxis"?this._label._elem.css("bottom","0px"):this._label._elem.css("top","0px"),this._label.pack()}}else{for(var n=0;n<d.length;n++){var o=d[n];if(o.show&&o.showLabel&&!o.isMinorTick){var p;if(o.constructor==a.jqplot.CanvasAxisTickRenderer&&o.angle){var q=this.name=="yaxis"?1:-1;switch(o.labelPosition){case"auto":case"end":q*o.angle<0?p=-o._textRenderer.height*Math.cos(-o._textRenderer.angle)/2:p=-o.getHeight()+o._textRenderer.height*Math.cos(o._textRenderer.angle)/2;break;case"start":o.angle>0?p=-o._textRenderer.height*Math.cos(-o._textRenderer.angle)/2:p=-o.getHeight()+o._textRenderer.height*Math.cos(o._textRenderer.angle)/2;break;case"middle":p=-o.getHeight()/2;break;default:p=-o.getHeight()/2}}else p=-o.getHeight()/2;var r=this.u2p(o.value)+p+"px";o._elem.css("top",r),o.pack()}}if(i){var t=this._label._elem.outerHeight(!0);this.name!=="yMidAxis"&&this._label._elem.css("top",g-k/2-t/2+"px"),this.name=="yaxis"?this._label._elem.css("left","0px"):this.name!=="yMidAxis"&&this._label._elem.css("right","0px"),this._label.pack()}}d=null}})(jQuery)