/**
 * jqPlot
 * Pure JavaScript plotting plugin using jQuery
 *
 * Version: 1.0.0b2_r1012
 *
 * Copyright (c) 2009-2011 Chris Leonello
 * jqPlot is currently available for use in all personal or commercial projects 
 * under both the MIT (http://www.opensource.org/licenses/mit-license.php) and GPL 
 * version 2.0 (http://www.gnu.org/licenses/gpl-2.0.html) licenses. This means that you can 
 * choose the license that best suits your project and use it accordingly. 
 *
 * Although not required, the author would appreciate an email letting him 
 * know of any substantial use of jqPlot.  You can reach the author at: 
 * chris at jqplot dot com or see http://www.jqplot.com/info.php .
 *
 * If you are feeling kind and generous, consider supporting the project by
 * making a donation at: http://www.jqplot.com/donate.php .
 *
 * sprintf functions contained in jqplot.sprintf.js by Ash Searle:
 *
 *     version 2007.04.27
 *     author Ash Searle
 *     http://hexmen.com/blog/2007/03/printf-sprintf/
 *     http://hexmen.com/js/sprintf.js
 *     The author (Ash Searle) has placed this code in the public domain:
 *     "This code is unrestricted: you are free to use it however you like."
 *
 * included jsDate library by Chris Leonello:
 *
 * Copyright (c) 2010-2011 Chris Leonello
 *
 * jsDate is currently available for use in all personal or commercial projects 
 * under both the MIT and GPL version 2.0 licenses. This means that you can 
 * choose the license that best suits your project and use it accordingly.
 *
 * jsDate borrows many concepts and ideas from the Date Instance 
 * Methods by Ken Snyder along with some parts of Ken's actual code.
 * 
 * Ken's origianl Date Instance Methods and copyright notice:
 * 
 * Ken Snyder (ken d snyder at gmail dot com)
 * 2008-09-10
 * version 2.0.2 (http://kendsnyder.com/sandbox/date/)     
 * Creative Commons Attribution License 3.0 (http://creativecommons.org/licenses/by/3.0/)
 *
 * jqplotToImage function based on Larry Siden's export-jqplot-to-png.js.
 * Larry has generously given permission to adapt his code for inclusion
 * into jqPlot.
 *
 * Larry's original code can be found here:
 *
 * https://github.com/lsiden/export-jqplot-to-png
 * 
 * 
 */
(function(a){function b(b,c,d){d=d||{},d.axesDefaults=d.axesDefaults||{},d.legend=d.legend||{},d.seriesDefaults=d.seriesDefaults||{};var e=!1;if(d.seriesDefaults.renderer==a.jqplot.DonutRenderer)e=!0;else if(d.series)for(var f=0;f<d.series.length;f++)d.series[f].renderer==a.jqplot.DonutRenderer&&(e=!0);e&&(d.axesDefaults.renderer=a.jqplot.DonutAxisRenderer,d.legend.renderer=a.jqplot.DonutLegendRenderer,d.legend.preDraw=!0,d.seriesDefaults.pointLabels={show:!1})}function c(b,c,d){for(var e=1;e<this.series.length;e++)if(!this.series[e]._previousSeries.length)for(var f=0;f<e;f++)this.series[e].renderer.constructor==a.jqplot.DonutRenderer&&this.series[f].renderer.constructor==a.jqplot.DonutRenderer&&this.series[e]._previousSeries.push(this.series[f]);for(e=0;e<this.series.length;e++)this.series[e].renderer.constructor==a.jqplot.DonutRenderer&&(this.series[e]._numberSeries=this.series.length,this.series[e].highlightMouseOver&&(this.series[e].highlightMouseDown=!1))}function e(b){for(var c=0;c<this.series.length;c++)this.series[c].seriesColors=this.seriesColors,this.series[c].colorGenerator=a.jqplot.colorGenerator}function f(a,b,c){var d=a.series[b],e=a.plugins.donutRenderer.highlightCanvas;e._ctx.clearRect(0,0,e._ctx.canvas.width,e._ctx.canvas.height),d._highlightedPoint=c,a.plugins.donutRenderer.highlightedSeriesIndex=b,d.renderer.drawSlice.call(d,e._ctx,d._sliceAngles[c][0],d._sliceAngles[c][1],d.highlightColors[c],!1)}function g(a){var b=a.plugins.donutRenderer.highlightCanvas;b._ctx.clearRect(0,0,b._ctx.canvas.width,b._ctx.canvas.height);for(var c=0;c<a.series.length;c++)a.series[c]._highlightedPoint=null;a.plugins.donutRenderer.highlightedSeriesIndex=null,a.target.trigger("jqplotDataUnhighlight")}function h(a,b,c,d,e){if(d){var h=[d.seriesIndex,d.pointIndex,d.data],i=jQuery.Event("jqplotDataMouseOver");i.pageX=a.pageX,i.pageY=a.pageY,e.target.trigger(i,h);if(e.series[h[0]].highlightMouseOver&&(h[0]!=e.plugins.donutRenderer.highlightedSeriesIndex||h[1]!=e.series[h[0]]._highlightedPoint)){var j=jQuery.Event("jqplotDataHighlight");j.pageX=a.pageX,j.pageY=a.pageY,e.target.trigger(j,h),f(e,h[0],h[1])}}else d==null&&g(e)}function i(a,b,c,d,e){if(d){var h=[d.seriesIndex,d.pointIndex,d.data];if(e.series[h[0]].highlightMouseDown&&(h[0]!=e.plugins.donutRenderer.highlightedSeriesIndex||h[1]!=e.series[h[0]]._highlightedPoint)){var i=jQuery.Event("jqplotDataHighlight");i.pageX=a.pageX,i.pageY=a.pageY,e.target.trigger(i,h),f(e,h[0],h[1])}}else d==null&&g(e)}function j(a,b,c,d,e){var f=e.plugins.donutRenderer.highlightedSeriesIndex;f!=null&&e.series[f].highlightMouseDown&&g(e)}function k(a,b,c,d,e){if(d){var f=[d.seriesIndex,d.pointIndex,d.data],g=jQuery.Event("jqplotDataClick");g.pageX=a.pageX,g.pageY=a.pageY,e.target.trigger(g,f)}}function l(a,b,c,d,e){if(d){var f=[d.seriesIndex,d.pointIndex,d.data],h=e.plugins.donutRenderer.highlightedSeriesIndex;h!=null&&e.series[h].highlightMouseDown&&g(e);var i=jQuery.Event("jqplotDataRightClick");i.pageX=a.pageX,i.pageY=a.pageY,e.target.trigger(i,f)}}function m(){this.plugins.donutRenderer&&this.plugins.donutRenderer.highlightCanvas&&(this.plugins.donutRenderer.highlightCanvas.resetCanvas(),this.plugins.donutRenderer.highlightCanvas=null),this.plugins.donutRenderer={highlightedSeriesIndex:null},this.plugins.donutRenderer.highlightCanvas=new a.jqplot.GenericCanvas;var b=a(this.targetId+" .jqplot-data-label");b.length?a(b[0]).before(this.plugins.donutRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-donutRenderer-highlight-canvas",this._plotDimensions,this)):this.eventCanvas._elem.before(this.plugins.donutRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-donutRenderer-highlight-canvas",this._plotDimensions,this));var c=this.plugins.donutRenderer.highlightCanvas.setContext();this.eventCanvas._elem.bind("mouseleave",{plot:this},function(a){g(a.data.plot)})}a.jqplot.DonutRenderer=function(){a.jqplot.LineRenderer.call(this)},a.jqplot.DonutRenderer.prototype=new a.jqplot.LineRenderer,a.jqplot.DonutRenderer.prototype.constructor=a.jqplot.DonutRenderer,a.jqplot.DonutRenderer.prototype.init=function(b,d){this.diameter=null,this.innerDiameter=null,this.thickness=null,this.padding=20,this.sliceMargin=0,this.ringMargin=null,this.fill=!0,this.shadowOffset=2,this.shadowAlpha=.07,this.shadowDepth=5,this.highlightMouseOver=!0,this.highlightMouseDown=!1,this.highlightColors=[],this.dataLabels="percent",this.showDataLabels=!1,this.dataLabelFormatString=null,this.dataLabelThreshold=3,this.dataLabelPositionFactor=.4,this.dataLabelNudge=0,this.startAngle=0,this.tickRenderer=a.jqplot.DonutTickRenderer,this._drawData=!0,this._type="donut",b.highlightMouseDown&&b.highlightMouseOver==null&&(b.highlightMouseOver=!1),a.extend(!0,this,b),this.diameter!=null&&(this.diameter=this.diameter-this.sliceMargin),this._diameter=null,this._innerDiameter=null,this._radius=null,this._innerRadius=null,this._thickness=null,this._previousSeries=[],this._numberSeries=1,this._sliceAngles=[],this._highlightedPoint=null;if(this.highlightColors.length==0)for(var f=0;f<this.seriesColors.length;f++){var g=a.jqplot.getColorComponents(this.seriesColors[f]),n=[g[0],g[1],g[2]],o=n[0]+n[1]+n[2];for(var p=0;p<3;p++)n[p]=o>570?n[p]*.8:n[p]+.3*(255-n[p]),n[p]=parseInt(n[p],10);this.highlightColors.push("rgb("+n[0]+","+n[1]+","+n[2]+")")}d.postParseOptionsHooks.addOnce(e),d.postInitHooks.addOnce(c),d.eventListenerHooks.addOnce("jqplotMouseMove",h),d.eventListenerHooks.addOnce("jqplotMouseDown",i),d.eventListenerHooks.addOnce("jqplotMouseUp",j),d.eventListenerHooks.addOnce("jqplotClick",k),d.eventListenerHooks.addOnce("jqplotRightClick",l),d.postDrawHooks.addOnce(m)},a.jqplot.DonutRenderer.prototype.setGridData=function(a){var b=[],c=[],d=this.startAngle/180*Math.PI,e=0;this._drawData=!1;for(var f=0;f<this.data.length;f++)this.data[f][1]!=0&&(this._drawData=!0),b.push(this.data[f][1]),c.push([this.data[f][0]]),f>0&&(b[f]+=b[f-1]),e+=this.data[f][1];var g=Math.PI*2/b[b.length-1];for(var f=0;f<b.length;f++)c[f][1]=b[f]*g,c[f][2]=this.data[f][1]/e;this.gridData=c},a.jqplot.DonutRenderer.prototype.makeGridData=function(a,b){var c=[],d=[],e=0,f=this.startAngle/180*Math.PI;this._drawData=!1;for(var g=0;g<a.length;g++)this.data[g][1]!=0&&(this._drawData=!0),c.push(a[g][1]),d.push([a[g][0]]),g>0&&(c[g]+=c[g-1]),e+=a[g][1];var h=Math.PI*2/c[c.length-1];for(var g=0;g<c.length;g++)d[g][1]=c[g]*h,d[g][2]=a[g][1]/e;return d},a.jqplot.DonutRenderer.prototype.drawSlice=function(a,b,c,d,e){function j(){c>6.282+this.startAngle&&(c=6.282+this.startAngle,b>c&&(b=6.281+this.startAngle));if(b>=c)return;a.beginPath(),a.fillStyle=d,a.strokeStyle=d,a.arc(0,0,f,b,c,!1),a.lineTo(g*Math.cos(c),g*Math.sin(c)),a.arc(0,0,g,c,b,!0),a.closePath(),h?a.fill():a.stroke()}var f=this._diameter/2,g=f-this._thickness,h=this.fill;a.save(),a.translate(this._center[0],this._center[1]);if(e)for(var i=0;i<this.shadowDepth;i++)a.save(),a.translate(this.shadowOffset*Math.cos(this.shadowAngle/180*Math.PI),this.shadowOffset*Math.sin(this.shadowAngle/180*Math.PI)),j();else j();if(e)for(var i=0;i<this.shadowDepth;i++)a.restore();a.restore()},a.jqplot.DonutRenderer.prototype.draw=function(b,c,d,e){var f,g=d!=undefined?d:{},h=0,i=0,j=1;if(d.legendInfo&&d.legendInfo.placement=="insideGrid"){var k=d.legendInfo;switch(k.location){case"nw":h=k.width+k.xoffset;break;case"w":h=k.width+k.xoffset;break;case"sw":h=k.width+k.xoffset;break;case"ne":h=k.width+k.xoffset,j=-1;break;case"e":h=k.width+k.xoffset,j=-1;break;case"se":h=k.width+k.xoffset,j=-1;break;case"n":i=k.height+k.yoffset;break;case"s":i=k.height+k.yoffset,j=-1;break;default:}}var l=g.shadow!=undefined?g.shadow:this.shadow,m=g.showLine!=undefined?g.showLine:this.showLine,n=g.fill!=undefined?g.fill:this.fill,o=b.canvas.width,p=b.canvas.height,q=o-h-2*this.padding,r=p-i-2*this.padding,s=Math.min(q,r),t=s,u=this.ringMargin==null?this.sliceMargin*2:this.ringMargin;for(var f=0;f<this._previousSeries.length;f++)t-=2*this._previousSeries[f]._thickness+2*u;this._diameter=this.diameter||t;if(this.innerDiameter!=null){var v=this._numberSeries>1&&this.index>0?this._previousSeries[0]._diameter:this._diameter;this._thickness=this.thickness||(v-this.innerDiameter-2*u*this._numberSeries)/this._numberSeries/2}else this._thickness=this.thickness||s/2/(this._numberSeries+1)*.85;var w=this._radius=this._diameter/2;this._innerRadius=this._radius-this._thickness;var x=this.startAngle/180*Math.PI;this._center=[(o-j*h)/2+j*h,(p-j*i)/2+j*i];if(this.shadow){var y="rgba(0,0,0,"+this.shadowAlpha+")";for(var f=0;f<c.length;f++){var z=f==0?x:c[f-1][1]+x;z+=this.sliceMargin/180*Math.PI,this.renderer.drawSlice.call(this,b,z,c[f][1]+x,y,!0)}}for(var f=0;f<c.length;f++){var z=f==0?x:c[f-1][1]+x;z+=this.sliceMargin/180*Math.PI;var A=c[f][1]+x;this._sliceAngles.push([z,A]),this.renderer.drawSlice.call(this,b,z,A,this.seriesColors[f],!1);if(this.showDataLabels&&c[f][2]*100>=this.dataLabelThreshold){var B,C=(z+A)/2,D;this.dataLabels=="label"?(B=this.dataLabelFormatString||"%s",D=a.jqplot.sprintf(B,c[f][0])):this.dataLabels=="value"?(B=this.dataLabelFormatString||"%d",D=a.jqplot.sprintf(B,this.data[f][1])):this.dataLabels=="percent"?(B=this.dataLabelFormatString||"%d%%",D=a.jqplot.sprintf(B,c[f][2]*100)):this.dataLabels.constructor==Array&&(B=this.dataLabelFormatString||"%s",D=a.jqplot.sprintf(B,this.dataLabels[f]));var E=this._innerRadius+this._thickness*this.dataLabelPositionFactor+this.sliceMargin+this.dataLabelNudge,F=this._center[0]+Math.cos(C)*E+this.canvas._offsets.left,G=this._center[1]+Math.sin(C)*E+this.canvas._offsets.top,H=a('<span class="jqplot-donut-series jqplot-data-label" style="position:absolute;">'+D+"</span>").insertBefore(e.eventCanvas._elem);F-=H.width()/2,G-=H.height()/2,F=Math.round(F),G=Math.round(G),H.css({left:F,top:G})}}},a.jqplot.DonutAxisRenderer=function(){a.jqplot.LinearAxisRenderer.call(this)},a.jqplot.DonutAxisRenderer.prototype=new a.jqplot.LinearAxisRenderer,a.jqplot.DonutAxisRenderer.prototype.constructor=a.jqplot.DonutAxisRenderer,a.jqplot.DonutAxisRenderer.prototype.init=function(b){this.tickRenderer=a.jqplot.DonutTickRenderer,a.extend(!0,this,b),this._dataBounds={min:0,max:100},this.min=0,this.max=100,this.showTicks=!1,this.ticks=[],this.showMark=!1,this.show=!1},a.jqplot.DonutLegendRenderer=function(){a.jqplot.TableLegendRenderer.call(this)},a.jqplot.DonutLegendRenderer.prototype=new a.jqplot.TableLegendRenderer,a.jqplot.DonutLegendRenderer.prototype.constructor=a.jqplot.DonutLegendRenderer,a.jqplot.DonutLegendRenderer.prototype.init=function(b){this.numberRows=null,this.numberColumns=null,a.extend(!0,this,b)},a.jqplot.DonutLegendRenderer.prototype.draw=function(){var b=this;if(this.show){var c=this._series,d="position:absolute;";d+=this.background?"background:"+this.background+";":"",d+=this.border?"border:"+this.border+";":"",d+=this.fontSize?"font-size:"+this.fontSize+";":"",d+=this.fontFamily?"font-family:"+this.fontFamily+";":"",d+=this.textColor?"color:"+this.textColor+";":"",d+=this.marginTop!=null?"margin-top:"+this.marginTop+";":"",d+=this.marginBottom!=null?"margin-bottom:"+this.marginBottom+";":"",d+=this.marginLeft!=null?"margin-left:"+this.marginLeft+";":"",d+=this.marginRight!=null?"margin-right:"+this.marginRight+";":"",this._elem=a('<table class="jqplot-table-legend" style="'+d+'"></table>');var e=!1,f=!1,g,h,i=c[0],j=new a.jqplot.ColorGenerator(i.seriesColors);if(i.show){var k=i.data;this.numberRows?(g=this.numberRows,this.numberColumns?h=this.numberColumns:h=Math.ceil(k.length/g)):this.numberColumns?(h=this.numberColumns,g=Math.ceil(k.length/this.numberColumns)):(g=k.length,h=1);var l,m,n,o,p,q,r,s,t=0;for(l=0;l<g;l++){f?n=a('<tr class="jqplot-table-legend"></tr>').prependTo(this._elem):n=a('<tr class="jqplot-table-legend"></tr>').appendTo(this._elem);for(m=0;m<h;m++)t<k.length&&(q=this.labels[t]||k[t][0].toString(),s=j.next(),f?l==g-1?e=!1:e=!0:l>0?e=!0:e=!1,r=e?this.rowSpacing:"0",o=a('<td class="jqplot-table-legend" style="text-align:center;padding-top:'+r+';"><div><div class="jqplot-table-legend-swatch" style="border-color:'+s+';"></div></div></td>'),p=a('<td class="jqplot-table-legend" style="padding-top:'+r+';"></td>'),this.escapeHtml?p.text(q):p.html(q),f?(p.prependTo(n),o.prependTo(n)):(o.appendTo(n),p.appendTo(n)),e=!0),t++}}}return this._elem};var d=!1;a.jqplot.preInitHooks.push(b),a.jqplot.DonutTickRenderer=function(){a.jqplot.AxisTickRenderer.call(this)},a.jqplot.DonutTickRenderer.prototype=new a.jqplot.AxisTickRenderer,a.jqplot.DonutTickRenderer.prototype.constructor=a.jqplot.DonutTickRenderer})(jQuery)